<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="currentTitle">綠色計程車熱力圖 - 導航頁</title> 
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding-top: 56px;
        }
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1030;
        }
        .navbar .container-fluid {
            justify-content: flex-start;
        }
        /* 核心：加載畫面樣式 (必須固定在 navbar 下方) */
        #loading-screen {
            position: fixed;
            top: 56px; /* 緊接在固定導航列下方 */
            left: 0;
            width: 100%;
            height: calc(100vh - 56px); /* 佔據剩餘全部空間 */
            background-color: #ffffff; /* 白色背景 */
            z-index: 1020; /* 位於 navbar (1030) 之下，但高於內容 */
            display: flex; 
            flex-direction: column;
            justify-content: center; /* 垂直置中 */
            align-items: center; /* 水平置中 */
            text-align: center;
        }
        
        /* 地圖容器樣式 (預設隱藏) */
        .iframe-container {
            width: 100%;
            height: calc(100vh - 56px); 
            margin: 0;
            padding: 0;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .loading-bar-container {
            width: 100%;
            max-width: 550px; /* 跑道寬度，現在更短且更居中 */
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-top: 20px;
            position: relative;
        }

        /* 計程車動畫 CSS */
        .taxi-runner {
            font-size: 2.5rem;
            position: absolute;
            right: 0; /* 讓計程車的基準點在跑道右側 */
            top: -30px; /* 將計程車圖標抬升到跑道上方 */
            animation: runTaxi 4s linear infinite; /* 4秒完成一次循環，線性，無限次 */
        }

        @keyframes runTaxi {
            0% {
                /* 初始位置 */
                transform: translateX(50px); 
            }
            100% {
                /* 終點位置 */
                transform: translateX(-350px); 
            }
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        
        <a class="navbar-brand" href="index.html" data-lang-key="home">🏠 儀表板主頁</a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav w-100">
                
                <a class="nav-link" href="multi_map_nav.html" data-lang-key="nav1">🗺️ 多地圖比較儀表板</a>
                <a class="nav-link" href="service_type_nav.html" data-lang-key="nav2">📍 服務類型集群圖</a>
                
                <span class="nav-link active text-success fw-bold" data-lang-key="nav3">💚 綠色計程車熱力圖</span>
                
                <a class="nav-link" href="yellow_taxi_nav.html" data-lang-key="nav4">💛 黃色計程車熱力圖</a>

                <div class="dropdown ms-auto mt-2 mt-lg-0">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="langDropdown">
                        語言 (Language)
                    </button>
                    <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="langDropdown">
                        <li><a class="dropdown-item" href="#" onclick="switchLanguage('zh-TW', '繁體中文')">繁體中文</a></li>
                        <li><a class="dropdown-item" href="#" onclick="switchLanguage('zh-CN', '简体中文')">简体中文</a></li>
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
</nav>

<div id="loading-screen">
    <div class="text-center">
        <h2 data-lang-key="loadingTitle" class="mb-3 text-secondary">儀表板正在努力加載中...</h2>
        
        <div class="loading-bar-container">
            <span class="taxi-runner">🚕</span>
        </div>
        <p class="mt-4 text-muted">請稍候...</p>
    </div>
</div>

<div class="iframe-container" id="main-content" style="display: none;">
    <iframe src="green_taxi_heatmap.html" frameborder="0" id="map-iframe"></iframe>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script>
    const translations = {
        'zh-TW': {
            home: '🏠 儀表板主頁',
            nav1: '🗺️ 多地圖比較儀表板',
            nav2: '📍 服務類型集群圖',
            nav3: '💚 綠色計程車熱力圖',
            nav4: '💛 黃色計程車熱力圖',
            currentTitle: '綠色計程車熱力圖 - 導航頁',
            loadingTitle: '儀表板正在努力加載中...' 
        },
        'zh-CN': {
            home: '🏠 仪表板主页',
            nav1: '🗺️ 多地图比较仪表板',
            nav2: '📍 服务类型集群图',
            nav3: '💚 绿色出租车热力图',
            nav4: '💛 黄色出租车热力图',
            currentTitle: '绿色出租车热力图 - 导航页',
            loadingTitle: '仪表板正在努力加载中...'
        }
    };
    
    function switchLanguage(lang, langText) {
        const langPack = translations[lang];
        if (!langPack) return;
        
        document.querySelector('[data-lang-key="currentTitle"]').innerText = langPack['currentTitle'];

        if (langText) {
            document.getElementById('langDropdown').innerText = langText;
        }

        document.querySelectorAll('[data-lang-key]').forEach(element => {
            const key = element.getAttribute('data-lang-key');
            if (langPack[key]) {
                element.innerText = langPack[key];
            }
        });
        localStorage.setItem('preferredLang', lang);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('preferredLang') || 'zh-TW';
        const initialText = (savedLang === 'zh-TW') ? '繁體中文' : '简体中文';
        switchLanguage(savedLang, initialText);

        const iframe = document.getElementById('map-iframe');
        const loadingScreen = document.getElementById('loading-screen');
        const mainContent = document.getElementById('main-content');

        iframe.onload = function() {
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            }, 500); 
        };
    });
</script>
</body>
</html>